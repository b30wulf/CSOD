<html>
<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<link href="style.css" type="text/css" rel=stylesheet>
<title>Совет 3</title>
</head>
<body lang=RU class="Normal" bgcolor="#FFFFFF">
<h2><a name="top">Совет 3. Разберитесь, что такое частные адреса и </a>NAT</h2>
<hr><div align="right"><a href="adv3.htm#p1">Вниз</a> | <a href="index.htm">Содержание</a> | <a href="adv2.htm">Назад</a> | <a href="adv4.htm">Далее</a></div>
<p style='text-align:justify;'>Раньше, когда доступ в Internet еще не был повсеместно 
  распространен, организации выбирали произвольный блок IP-адресов для своих сетей. 
  Считалось, что сеть не подключена и «никогда не будет подключена» к внешним 
  сетям, hostomv выбор IP-адресов не имеет значения. Но жизнь не стоит на месте, 
  и в настоящее время очень мало сетей, которые не имеют выхода в Internet.</p>
<p style='text-align:justify;'>Теперь необязательно выбирать для частной сети 
  произвольный блок IP-адресов. В RFC 1918 [Rekhter, Moskowitz et al. 1996] специфицированы 
  три блока адресов, которые не будут выделяться:</p>
<ul type=disc>
  <li style='text-align:justify;     '>10.0.0.0-10.255.255.255 (префикс 10/8);</li>
  <li style='text-align:justify;     '>172.16.0.0-172.31.255.255 (префикс 172.16/12);</li>
  <li style='text-align:justify;     '>192.168.0.0-192.168.255.255 (префикс 192.168/16).</li>
</ul>
<p style='text-align:justify;'>Если использовать для своей сети один из этих блоков, 
  то любой хост сможет обратиться к другому хосту в этой же сети, не опасаясь 
  конфликта с глобально выделенным IP-адресом. Разумеется, пока сеть не имеет 
  выхода во внешние сети, выбор адресов не имеет значения. Но почему бы сразу 
  не воспользоваться одним из блоков частных адресов и не застраховаться тем самым 
  от неприятностей, которые могут произойти, когда внешний выход все-таки появится?</p>
<p style='text-align:justify;'>Что случится, когда сеть получит внешний выход? 
  Как хост с частным IP-адресом сможет общаться с другим хостом в Internet или 
  другой внешней сети? Самый распространенный ответ - нужно воспользоваться преобразованием 
  сетевых адресов (Network Address Translation - NAT). Есть несколько типов устройств, 
  поддерживающих NAT. Среди них маршрутизаторы, межсетевые экраны (firewalls) 
  и автономные устройства с поддержкой NAT. Принцип работы NAT заключается в преобразовании 
  между частными сетевыми адресами и одним или несколькими глобально выделенными 
  IP-адресами. Большинство устройств с поддержкой NAT можно сконфигурировать в 
  трех режимах:</p>
<ul type=disc>
  <li style='text-align:justify;     '>статический. Адреса всех или некоторых 
    хостов в частной сети отображаются на один и тот же фиксированный, глобально 
    выделенный адрес;</li>
  <li style='text-align:justify;     '>выбор из пула. Устройство с поддержкой 
    NAT имеет пул глобально выделенных IP-адресов и динамически назначает один 
    из них хосту, которому нужно связаться с хостом во внешней сети;</li>
  <li style='text-align:justify;     '>РАТ, или преобразование адресов портов 
    (port address translation). Этот метод применяется, когда есть единственный 
    глобально выделенный адрес (рис. 2.11). При этом каждый частный адрес отображается 
    на один и тот ж внешний адрес, но номер порта исходящего пакета заменяется 
    уникальным значением, которое в дальнейшем используется для ассоциирования 
    входящих пакетов с частным сетевым адресом.</li>
</ul>
<p style='text-align:justify;'>На рис. 2.11 представлена небольшая сеть с тремя 
  хостами, для которой и пользуется блок адресов 10/8. Имеется также маршрутизатор, 
  помеченный NAT у которого есть адрес в частной сети и адрес в Internet.</p>
<p align=center style='text-align:center;'> <img width=415 height=237
src="./img/image014.gif" v:shapes="_x0000_i1026"> </p>
<p align=center style='text-align:center;'>Рис. 2.11. Частная сеть с маршрутизатором, 
  который поддерживает NAT</p>
<p style='text-align:justify;'>Поскольку показан только один глобальный адрес, 
  ассоциированный с NAT, предположим, что маршрутизатор сконфигурирован с возможностью 
  использования метода РАТ. Статический режим и режим выбора из пула аналогичны 
  методу РАТ, но проще его, поскольку не нужно преобразовывать еще и номера портов.</p>
<p style='text-align:justify;'>Допустим, что хосту Н2 надо отправить SYN-сегмент 
  TCP по адресу 204.71.200.69 -на один из Web-серверов www.yahoo.com. - чтобы 
  открыть соединение. На рис. 2.12а видно, что у сегмента, покидающего Н2, адрес 
  получателя равен 204.71.200.69.80, а адрес отправителя - 10.0.0.2.9600.</p>
<p style='text-align:justify;'><i>Примечание:</i> Здесь использована стандартная 
  нотация, согласно которой адрес, записанный в форме A.B.C.D.P означает IP-адресA.B.C.D 
  и порт Р.</p>
<p style='text-align:justify;'>В этом нет ничего особенного, за исключением того, 
  что адрес отправителя принадлежит частной сети. Когда этот сегмент доходит до 
  маршрутизатора, NAT Должен заменить адрес отправителя на 205.184.151.171, чтобы 
  Web-сервер на сайте Yahoo знал, куда посылать сегмент SYN/ACK и последующие. 
  Поскольку во всех пакетах, исходящих от других хостов в частной сети, адрес 
  отправителя также будет заменен на 205.184.151.171, NAT необходимо изменить 
  еще и номер пора некоторое уникальное значение, чтобы потом определять, какому 
  хосту следует переправлять входящие пакеты. Исходящий порт 9600 преобразуется 
  в 5555. Таким образом, у сегмента, доставленного на сайт Yahoo, адрес получателя 
  будет 204.71.200.69.80, а адрес отправителя&nbsp;- 205.184.151.171.5555.</p>
<p align=center style='text-align:center;
'> <img width=551 height=125
src="./img/image015.gif" v:shapes="_x0000_i1025"> </p>
<p align=center style='text-align:center;
'>Рис. 2.12. Преобразование адресов портов</p>
<p style='text-align:justify;'>Из рис. 2.12б видно также, что в дошедшем до маршрутизатора 
  ответе Yahoo адрес получателя равен 205.184.151.171.5555. NAT ищет этот номер 
  порта в своей внутренней таблице и обнаруживает, что порт 5555 соответствует 
  адресу 10.0.0.1.9600, так что после получения от маршрутизатора этого пакета 
  в хосте Н2 появится информация, что адрес отправителя равен 204.71.200.69.80, 
  а адрес получателя&nbsp;- 10.0.0.1.9600.</p>
<p style='text-align:justify;'>Описанный здесь метод PAT выглядит довольно примитивно, 
  но есть много усложняющих его деталей. Например, при изменении адреса отправителя 
  или но мера исходящего порта меняются как контрольная сумма заголовка IР&nbsp;- 
  датаграммы так и контрольная сумма TCP-сегмента, поэтому их необходимо скорректировать.</p>
<p style='text-align:justify;'>В качестве другого примера возможных осложнений 
  рассмотрим протокол передачи файлов FTP (File Transfer Protocol) [Reynolds and 
  Postel 1985]. Когда FTP-клиенту нужно отправить файл или принять его от FTP-сервера, 
  серверу посылается команда PORT с указанием адреса и номера порта, по которому 
  будет ожидаться соединение (для передачи данных) от сервера. При этом NAT нужно 
  распознать TCP-сегмент, содержащий команду PORT протокола FTP, и подменить в 
  ней адрес и порт. В команде PORT адрес и номер порта представлены в виде ASCII-строк, 
  поэтому при их подмене может измениться размер сегмента. А это, в свою очередь, 
  повлечет изменение порядковых номеров байтов. Так что NAT должен за этим следить, 
  чтобы вовремя скорректировать порядковые номера в сегменте подтверждения АСК, 
  а также в последующих сегментах с того же хоста.</p>
<p style='text-align:justify;'>Несмотря на все эти сложности, NAT работает неплохо 
  и широко распространен. В частности, PAT - это естественный способ подключения 
  небольших сетей к Internet в ситуации, когда имеется только одна точка выхода.</p>
<h3><a name="p1">Резюме</a></h3>
<p style='text-align:justify;'>В этом разделе показано, как схема NAT позволяет 
  использовать один из блоков частных сетевых адресов для внутренних хостов, сохраняя 
  при этом возможность выхода в Internet. Метод PAT, в частности, особенно полезен 
  для небольших сетей, у которых есть только один глобально выделенный IP-адрес. 
  К сожалению, поскольку PAT изменяет номер порта в исходящих пакетах, он может 
  оказаться несовместимым с нестандартными протоколами, которые передают информацию 
  о номерах портов в теле сообщения.</p>
<hr><div align="right"><a href="adv3.htm#top">Вверх</a> | <a href="index.htm">Содержание</a> | <a href="adv2.htm">Назад</a> | <a href="adv4.htm">Далее</a></div>
</body>
</html>
